<!DOCTYPE html>
<html>

<head>
    <title>Blockly for house Demo#2</title>
</head>

<body>
    <!--Import blockly library and standard blocks-->
    <script src="../../../blockly/blockly_compressed.js"></script>
    <script src="../../../blockly/blocks_compressed.js"></script>
    <script src="../../../blockly/msg/js/en.js"></script>
    <script src="../../../blockly/python_compressed.js"></script>
    <!--Import our blocks-->
    <script src="../blocks/Actuators/door.js"></script>
    <script src="../blocks/Actuators/lamp.js"></script>
    <script src="../blocks/Sensors/illuminance.js"></script>
    <script src="../blocks/Sensors/humidity.js"></script>
    <script src="../blocks/Sensors/temperature.js"></script>
    <!--Import generation from our blocks-->
    <script src="../generators/python/Actuators/door.js"></script>
    <script src="../generators/python/Actuators/lamp.js"></script>
    <script src="../generators/python/Sensors/illuminance.js"></script>
    <script src="../generators/python/Sensors/humidity.js"></script>
    <script src="../generators/python/Sensors/temperature.js"></script>


    <h1>Blockly for house Demo#2</h1>
    <h3>Открытие двери при высокой температуре: Использование переменных</h3>
    <p><a href="../../../index.html">Back</a></p>

    <textarea id="xml_demo" style="display:none;">
      <xml xmlns="http://www.w3.org/1999/xhtml">
        <variables>
          <variable type="" id="3F:X/;Ma.%8#KayW5^es">sensor</variable>
          <variable type="" id="0-?6phjZ-c}4[!0{~b`o">door</variable>
        </variables>
        <block type="variables_set" id="{TyEJbWUur,1^#|^`P)C" x="-358" y="-261">
          <field name="VAR" id="3F:X/;Ma.%8#KayW5^es" variabletype="">sensor</field>
          <value name="VALUE">
            <block type="tem_sensor" id="zz{[thCjaE[*yDJWy;u2">
              <value name="NAME">
                <block type="text" id="_AkA`76|8fSsFS|~B_+#">
                  <field name="TEXT">sensor1</field>
                </block>
              </value>
            </block>
          </value>
          <next>
            <block type="variables_set" id="d=n$Zq^ZGhd|E(0y0*|?">
              <field name="VAR" id="0-?6phjZ-c}4[!0{~b`o" variabletype="">door</field>
              <value name="VALUE">
                <block type="door" id="TViKIO%%Y$m[)6,$tvIP">
                  <value name="NAME">
                    <block type="text" id="e`Xtc]l=F$(]6@y1SBVi">
                      <field name="TEXT">door1</field>
                    </block>
                  </value>
                </block>
              </value>
              <next>
                <block type="controls_if" id="urDWJ2r;WRO?p~;Kf^U-">
                  <value name="IF0">
                    <block type="logic_compare" id="j.oUwBiz:JR8_FP:yb)F">
                      <field name="OP">EQ</field>
                      <value name="A">
                        <block type="tem_get" id="|5HV~^D!4T%7p;oSdW{I">
                          <value name="tem_sensor">
                            <block type="variables_get" id="2Kv11`ovN%b{UhoJbVpK">
                              <field name="VAR" id="3F:X/;Ma.%8#KayW5^es" variabletype="">sensor</field>
                            </block>
                          </value>
                        </block>
                      </value>
                      <value name="B">
                        <block type="temperature" id="F7wP$!t9c}eIU54BLjw)">
                          <field name="Unit">Celsius</field>
                          <value name="Value">
                            <block type="math_number" id="04jwD?d4P0VA/Ke]lKBj">
                              <field name="NUM">25</field>
                            </block>
                          </value>
                        </block>
                      </value>
                    </block>
                  </value>
                  <statement name="DO0">
                    <block type="open_door" id="52)*s9Eo4p-pC6]P$-0Q">
                      <value name="door">
                        <block type="variables_get" id="RSPY./Y6Ax7Q+]3Er%b0">
                          <field name="VAR" id="0-?6phjZ-c}4[!0{~b`o" variabletype="">door</field>
                        </block>
                      </value>
                    </block>
                  </statement>
                  <next>
                    <block type="variables_set" id="y(-Nsdv]2-){#h3Nr1T*">
                      <field name="VAR" id="3F:X/;Ma.%8#KayW5^es" variabletype="">sensor</field>
                      <value name="VALUE">
                        <block type="tem_sensor" id="2I1AJ6XSJ6/_tcOBFqaz">
                          <value name="NAME">
                            <block type="text" id="dQJl3;,If2GH/,MYS,Mf">
                              <field name="TEXT">sensor2</field>
                            </block>
                          </value>
                        </block>
                      </value>
                      <next>
                        <block type="variables_set" id="iTlBnk4^L;h*J^i`XLnh">
                          <field name="VAR" id="0-?6phjZ-c}4[!0{~b`o" variabletype="">door</field>
                          <value name="VALUE">
                            <block type="door" id=":xfnL?fpiFi`vW;g[tG?">
                              <value name="NAME">
                                <block type="text" id="N^GK`junIieR6I933=!*">
                                  <field name="TEXT">door2</field>
                                </block>
                              </value>
                            </block>
                          </value>
                          <next>
                            <block type="controls_if" id=";*v]8$EH~?p?t^NGr[E0">
                              <value name="IF0">
                                <block type="logic_compare" id=")(I3ok8t5z4v7+!c2#^V">
                                  <field name="OP">EQ</field>
                                  <value name="A">
                                    <block type="tem_get" id="itH#$-q^LTIC@A@_CZ}b">
                                      <value name="tem_sensor">
                                        <block type="variables_get" id=",;-0q`jZ:TrRD_vo[$_v">
                                          <field name="VAR" id="3F:X/;Ma.%8#KayW5^es" variabletype="">sensor</field>
                                        </block>
                                      </value>
                                    </block>
                                  </value>
                                  <value name="B">
                                    <block type="temperature" id="`w+N9[-CcZ6|DFS/~R$R">
                                      <field name="Unit">Celsius</field>
                                      <value name="Value">
                                        <block type="math_number" id="OTO|6nu;BMgLI^qUxopR">
                                          <field name="NUM">27</field>
                                        </block>
                                      </value>
                                    </block>
                                  </value>
                                </block>
                              </value>
                              <statement name="DO0">
                                <block type="open_door" id="Q4Y7bLVG?3pRxIw5}Mn*">
                                  <value name="door">
                                    <block type="variables_get" id="KqcG0wRAEE8gmcCA2i-J">
                                      <field name="VAR" id="0-?6phjZ-c}4[!0{~b`o" variabletype="">door</field>
                                    </block>
                                  </value>
                                </block>
                              </statement>
                            </block>
                          </next>
                        </block>
                      </next>
                    </block>
                  </next>
                </block>
              </next>
            </block>
          </next>
        </block>
      </xml>
    </textarea>

    <div id="blocklyDiv" style="height: 480px; width: 1200px;"></div>
    <xml id="toolbox" style="display: none">
        <category name="Logic" colour="%{BKY_LOGIC_HUE}">
            <category name="If">
                <block type="controls_if"></block>
                <block type="controls_if">
                    <mutation else="1"></mutation>
                </block>
                <block type="controls_if">
                    <mutation elseif="1" else="1"></mutation>
                </block>
            </category>
            <category name="Boolean" colour="%{BKY_LOGIC_HUE}">
                <block type="logic_compare"></block>
                <block type="logic_operation"></block>
                <block type="logic_negate"></block>
                <block type="logic_boolean"></block>
                <block type="logic_null"></block>
                <block type="logic_ternary"></block>
            </category>
        </category>
        <category name="Loops" colour="%{BKY_LOOPS_HUE}">
            <block type="controls_repeat_ext">
                <value name="TIMES">
                    <block type="math_number">
                        <field name="NUM">10</field>
                    </block>
                </value>
            </block>
            <block type="controls_whileUntil"></block>
            <block type="controls_for">
                <field name="VAR">i</field>
                <value name="FROM">
                    <block type="math_number">
                        <field name="NUM">1</field>
                    </block>
                </value>
                <value name="TO">
                    <block type="math_number">
                        <field name="NUM">10</field>
                    </block>
                </value>
                <value name="BY">
                    <block type="math_number">
                        <field name="NUM">1</field>
                    </block>
                </value>
            </block>
            <block type="controls_forEach"></block>
            <block type="controls_flow_statements"></block>
        </category>
        <category name="Math" colour="%{BKY_MATH_HUE}">
            <block type="math_number">
                <field name="NUM">123</field>
            </block>
            <block type="math_arithmetic"></block>
            <block type="math_single"></block>
            <block type="math_trig"></block>
            <block type="math_constant"></block>
            <block type="math_number_property"></block>
            <block type="math_round"></block>
            <block type="math_on_list"></block>
            <block type="math_modulo"></block>
            <block type="math_constrain">
                <value name="LOW">
                    <block type="math_number">
                        <field name="NUM">1</field>
                    </block>
                </value>
                <value name="HIGH">
                    <block type="math_number">
                        <field name="NUM">100</field>
                    </block>
                </value>
            </block>
            <block type="math_random_int">
                <value name="FROM">
                    <block type="math_number">
                        <field name="NUM">1</field>
                    </block>
                </value>
                <value name="TO">
                    <block type="math_number">
                        <field name="NUM">100</field>
                    </block>
                </value>
            </block>
            <block type="math_random_float"></block>
            <block type="math_atan2"></block>
        </category>
        <category name="Lists" colour="%{BKY_LISTS_HUE}">
            <block type="lists_create_empty"></block>
            <block type="lists_create_with"></block>
            <block type="lists_repeat">
                <value name="NUM">
                    <block type="math_number">
                        <field name="NUM">5</field>
                    </block>
                </value>
            </block>
            <block type="lists_length"></block>
            <block type="lists_isEmpty"></block>
            <block type="lists_indexOf"></block>
            <block type="lists_getIndex"></block>
            <block type="lists_setIndex"></block>
        </category>
        <sep></sep>
        <category name="Text" colour="%{BKY_TEXTS_HUE}">
            <block type="text"></block>
            <block type="text_length"></block>
            <block type="text_print"></block>
        </category>
        <sep></sep>
        <category name="Actuators" colour=110>
            <category name="Door" colour=130>
                <block type="door"></block>
                <block type="open_door"></block>
                <block type="close_door"></block>
                <block type="door_is_open"></block>
            </category>
            <sep></sep>
            <category name="Lamp">
                <block type="lamp"></block>
                <block type="off_lamp"></block>
                <block type="on_lamp"></block>
                <block type="lamp_is_on"></block>
            </category>
            <sep></sep>
        </category>
        <sep></sep>
        <category name="Sensors" colour=170>
            <category name="Temperature">
                <block type="tem_sensor"></block>
                <block type="tem_get"></block>
                <block type="temperature"></block>
            </category>
            <category name="Humidity">
                <block type="hum_sensor"></block>
                <block type="hum_get"></block>
                <block type="humidity"></block>
            </category>
            <category name="Illuminance">
                <block type="il_sensor"></block>
                <block type="il_get"></block>
                <block type="illuminance"></block>
            </category>
        </category>
        <sep></sep>
        <category name="Variables" colour="%{BKY_VARIABLES_HUE}" custom="VARIABLE"></category>
        <category name="Functions" colour="%{BKY_PROCEDURES_HUE}" custom="PROCEDURE"></category>
    </xml>
    <script>
        var workspace = Blockly.inject('blocklyDiv',
            { toolbox: document.getElementById('toolbox') });

    </script>
    <h5>Code output / Xml input</h5>
    <textarea id='code_output' style="height: 480px; width: 1200px;">#here will be code!</textarea>


    <script>
        function generate(event) {
            var code = Blockly.Python.workspaceToCode(workspace);
            document.getElementById('code_output').value = code;
        }
        workspace.addChangeListener(generate);
    </script>
    <script>
        function get_xml() {
            console.log('inside get_xml');
            var xml = Blockly.Xml.workspaceToDom(workspace);
            document.getElementById('code_output').value = Blockly.Xml.domToPrettyText(xml);;
        }
        function from_xml() {
            console.log('inside from_xml');
            var xml = document.getElementById("code_output").value;
            Blockly.Xml.appendDomToWorkspace(Blockly.Xml.textToDom(xml), workspace);
        }
        var xml = document.getElementById('xml_demo').value;
        Blockly.Xml.appendDomToWorkspace(Blockly.Xml.textToDom(xml), workspace);
    </script>
    <button id="to_xml_button" onclick="get_xml()">To XML</button>
    <button id='from_xml_button' onclick="from_xml()">From XML</button>

</body>

</html>